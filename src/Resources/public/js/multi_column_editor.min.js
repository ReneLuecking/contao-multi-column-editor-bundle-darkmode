var MultiColumnEditor={init:function(){var a=document.createElement("script");a.onload=function(){MultiColumnEditor.registerEvents()};a.src="https://cdn.jsdelivr.net/npm/sortablejs@1.6.1/Sortable.min.js";document.head.appendChild(a)},registerEvents:function(){var c=document.querySelectorAll(".multi-column-editor .add");var b=document.querySelectorAll(".multi-column-editor .delete");for(var d=0;d<c.length;d++){c[d].addEventListener("click",function(g){g.preventDefault();MultiColumnEditor.triggerAction(this,"addRow")})}for(var d=0;d<b.length;d++){b[d].addEventListener("click",function(g){g.preventDefault();MultiColumnEditor.triggerAction(this,"deleteRow")})}var e=document.querySelectorAll(".multi-column-editor-wrapper .sortable");for(var d=0,a=e.length;d<a;d++){var f=Sortable.create(e[d],{handle:".drag-handle",onEnd:function(j){var h=[],l=false,k=j.item.closest(".rows").querySelectorAll(".mce-row");for(var g=0;g<k.length;g++){h.push(k[g].dataset.index);if(k[g].dataset.index!==$(this).index()+1){l=true}}additionalData=[{name:"newIndices",value:h.join(",")}];if(l){MultiColumnEditor.triggerAction(j.item.querySelector(".drag-handle"),"sortRows",additionalData)}},})}},triggerAction:function(l,f,c,d){var b=l.closest("form"),e=new FormData(),k=l.closest(".multi-column-editor"),a=l.href;var h=b.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var g=0,j=h.length;g<j;g++){var m=h[g];if(m.name!=="FORM_SUBMIT"){e.append(m.name,m.value)}}e.set("row",l.closest(".mce-row").dataset.index);e.set("field",k.dataset.field);e.set("table",k.dataset.table);if(typeof c!=="undefined"){for(var g=0,j=c.length;g<j;g++){var m=c[g];if(m.name!=="FORM_SUBMIT"){e.append(m.name,m.value)}}}var n=new XMLHttpRequest();n.onreadystatechange=function(){if(n.readyState===4){var p=document.createEvent("CustomEvent");p.initEvent("ajaxSuccess",true,true);document.dispatchEvent(p);if(n.status===200){var o=JSON.parse(n.responseText);var i=document.createElement("div");i.innerHTML=o.result.html;l.closest(".multi-column-editor-wrapper").replaceWith(i.childNodes[0]);MultiColumnEditor.registerEvents();if(typeof callback==="function"){callback.apply(this,Array.prototype.slice.call(arguments,1))}var p=document.createEvent("CustomEvent");p.initEvent("ajaxComplete",true,true);document.dispatchEvent(p)}}};n.open("POST",a);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(e)}};(function(c){if(typeof c.matches!=="function"){c.matches=c.msMatchesSelector||c.mozMatchesSelector||c.webkitMatchesSelector||function b(d){var f=this;var g=(f.document||f.ownerDocument).querySelectorAll(d);var e=0;while(g[e]&&g[e]!==f){++e}return Boolean(g[e])}}if(typeof c.closest!=="function"){c.closest=function a(d){var e=this;while(e&&e.nodeType===1){if(e.matches(d)){return e}e=e.parentNode}return null}}})(window.Element.prototype);document.addEventListener("DOMContentLoaded",function(a){MultiColumnEditor.init()});