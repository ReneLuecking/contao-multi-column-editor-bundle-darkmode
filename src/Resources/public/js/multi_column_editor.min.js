var MultiColumnEditor={init:function(){var e=document.createElement("script");e.onload=function(){MultiColumnEditor.registerEvents()},e.src="bundles/heimrichhannotcontaomulticolumneditor/js/Sortable.min.js",document.head.appendChild(e)},registerEvents:function(){for(var e=document.querySelectorAll(".multi-column-editor .add"),t=document.querySelectorAll(".multi-column-editor .delete"),n=0;n<e.length;n++)e[n].addEventListener("click",function(e){e.preventDefault(),MultiColumnEditor.triggerAction(this,"addRow")});for(n=0;n<t.length;n++)t[n].addEventListener("click",function(e){e.preventDefault(),MultiColumnEditor.triggerAction(this,"deleteRow")});for(var o=document.querySelectorAll(".multi-column-editor-wrapper .sortable"),a=(n=0,o.length);n<a;n++)Sortable.create(o[n],{handle:".drag-handle",onEnd:function(e){for(var t=[],n=!1,o=e.item.closest(".rows").querySelectorAll(".mce-row"),a=0;a<o.length;a++)t.push(o[a].dataset.index),o[a].dataset.index!==$(this).index()+1&&(n=!0);additionalData=[{name:"newIndices",value:t.join(",")}],n&&MultiColumnEditor.triggerAction(e.item.querySelector(".drag-handle"),"sortRows",additionalData)}})},triggerAction:function(e,t,n,o){for(var a=e.closest("form"),r=new FormData,i=e.closest(".multi-column-editor"),l=e.href,c=a.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])"),d=0,u=c.length;d<u;d++){if("FORM_SUBMIT"!==(m=c[d]).name)switch(m.type){case"checkbox":case"radio":r.append(m.name,m.checked?m.value:"");break;default:r.append(m.name,m.value)}}var s=e.closest(".mce-row");if(r.set("row",void 0!==s&&null!==s?s.dataset.index:0),r.set("field",i.dataset.field),r.set("table",i.dataset.table),void 0!==n)for(d=0,u=n.length;d<u;d++){var m;if("FORM_SUBMIT"!==(m=n[d]).name)switch(m.type){case"checkbox":case"radio":r.append(m.name,m.checked?m.value:"");break;default:r.append(m.name,m.value)}}var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4===h.readyState&&((t=document.createEvent("CustomEvent")).initEvent("ajaxSuccess",!0,!0),document.dispatchEvent(t),200===h.status)){var t,n=JSON.parse(h.responseText),o=document.createElement("div");o.innerHTML=n.result.html,e.closest(".multi-column-editor-wrapper").replaceWith(o.childNodes[0]),MultiColumnEditor.registerEvents(),"function"==typeof callback&&callback.apply(this,Array.prototype.slice.call(arguments,1)),(t=document.createEvent("CustomEvent")).initEvent("ajaxComplete",!0,!0),document.dispatchEvent(t)}},h.open("POST",l),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(r)}};!function(e){"function"!=typeof e.matches&&(e.matches=e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,n=(t.document||t.ownerDocument).querySelectorAll(e),o=0;n[o]&&n[o]!==t;)++o;return Boolean(n[o])}),"function"!=typeof e.closest&&(e.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null})}(window.Element.prototype),document.addEventListener("DOMContentLoaded",function(e){MultiColumnEditor.init()});
