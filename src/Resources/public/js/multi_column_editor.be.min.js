var MultiColumnEditor={init:function(){this.registerEvents()},registerEvents:function(){for(var a=document.querySelectorAll('.multi-column-editor .add'),b=document.querySelectorAll('.multi-column-editor .delete'),c=0;c<a.length;c++)a[c].addEventListener('click',function(a){a.preventDefault(),MultiColumnEditor.triggerAction(this,'addRow')});for(var c=0;c<b.length;c++)b[c].addEventListener('click',function(a){a.preventDefault(),MultiColumnEditor.triggerAction(this,'deleteRow')});(function(a){new Sortables(a,{constrain:!0,opacity:.6,handle:'.drag-handle',onComplete:function(a){for(var b=[],c=!1,d=a.closest('.rows').querySelectorAll('.mce-row'),e=0;e<d.length;e++)b.push(d[e].dataset.index),d[e].dataset.index!==[].slice.call(d).indexOf(this)+1&&(c=!0);additionalData=[{name:'newIndices',value:b.join(',')}],c&&MultiColumnEditor.triggerAction(a.querySelector('.drag-handle'),'sortRows',additionalData)}})})('.multi-column-editor-wrapper .sortable')},triggerAction:function(a,b,c){for(var d,e=a.closest('form'),f=new FormData,g=a.closest('.multi-column-editor'),h=a.href,j=e.querySelectorAll('input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])'),k=0,i=j.length;k<i;k++)d=j[k],'FORM_SUBMIT'!==d.name&&f.append(d.name,d.value);var l=a.closest('.mce-row');if(f.set('row','undefined'!=typeof l&&null!==l?l.dataset.index:0),f.set('field',g.dataset.field),f.set('table',g.dataset.table),f.set('action',b),'undefined'!=typeof c)for(var d,k=0,i=c.length;k<i;k++)d=c[k],'FORM_SUBMIT'!==d.name&&f.append(d.name,d.value);var m=new XMLHttpRequest;m.onreadystatechange=function(){if(4===m.readyState){var b=document.createEvent('CustomEvent');if(b.initEvent('ajaxSuccess',!0,!0),document.dispatchEvent(b),200===m.status){var c=document.createElement('div');c.innerHTML=m.responseText,a.closest('.multi-column-editor-wrapper').replaceWith(c.childNodes[0]),MultiColumnEditor.registerEvents(),MultiColumnEditor.initChosen(),'function'==typeof callback&&callback.apply(this,Array.prototype.slice.call(arguments,1));var b=document.createEvent('CustomEvent');b.initEvent('ajaxComplete',!0,!0),document.dispatchEvent(b)}}},m.open('POST',h),m.setRequestHeader('X-Requested-With','XMLHttpRequest'),m.send(f)}};(function(a){'function'!=typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return!!c[d]}),'function'!=typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})})(window.Element.prototype),document.addEventListener('DOMContentLoaded',function(){MultiColumnEditor.init()}),function(){'function'==typeof window.addEvent&&window.addEvent('domready',function(){MultiColumnEditor.initChosen=function(){$$('.multi-column-editor select.tl_chosen').each(function(a){'undefined'==typeof a.initialized&&(a.initialized=$$('#'+a.getAttribute('id')).chosen())})}})}();