var MultiColumnEditor={init:function(){this.registerEvents()},registerEvents:function(){var b=document.querySelectorAll(".multi-column-editor .add");var a=document.querySelectorAll(".multi-column-editor .delete");for(var c=0;c<b.length;c++){b[c].addEventListener("click",function(e){e.preventDefault();MultiColumnEditor.triggerAction(this,"addRow")})}for(var c=0;c<a.length;c++){a[c].addEventListener("click",function(e){e.preventDefault();MultiColumnEditor.triggerAction(this,"deleteRow")})}function d(e){new Sortables(e,{constrain:true,opacity:0.6,handle:".drag-handle",onComplete:function(k){var g=[],j=false,h=k.closest(".rows").querySelectorAll(".mce-row");for(var f=0;f<h.length;f++){g.push(h[f].dataset.index);if(h[f].dataset.index!==[].slice.call(h).indexOf(this)+1){j=true}}additionalData=[{name:"newIndices",value:g.join(",")}];if(j){MultiColumnEditor.triggerAction(k.querySelector(".drag-handle"),"sortRows",additionalData)}}})}d(".multi-column-editor-wrapper .sortable")},triggerAction:function(l,f,c,d){var b=l.closest("form"),e=new FormData(),k=l.closest(".multi-column-editor"),a=l.href;var h=b.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])");for(var g=0,j=h.length;g<j;g++){var m=h[g];if(m.name!=="FORM_SUBMIT"){e.append(m.name,m.value)}}e.set("row",l.closest(".mce-row").dataset.index);e.set("field",k.dataset.field);e.set("table",k.dataset.table);e.set("action",f);if(typeof c!=="undefined"){for(var g=0,j=c.length;g<j;g++){var m=c[g];if(m.name!=="FORM_SUBMIT"){e.append(m.name,m.value)}}}var n=new XMLHttpRequest();n.onreadystatechange=function(){if(n.readyState===4){var o=document.createEvent("CustomEvent");o.initEvent("ajaxSuccess",true,true);document.dispatchEvent(o);if(n.status===200){var i=document.createElement("div");i.innerHTML=n.responseText;l.closest(".multi-column-editor-wrapper").replaceWith(i.childNodes[0]);MultiColumnEditor.registerEvents();MultiColumnEditor.initChosen();if(typeof callback==="function"){callback.apply(this,Array.prototype.slice.call(arguments,1))}var o=document.createEvent("CustomEvent");o.initEvent("ajaxComplete",true,true);document.dispatchEvent(o)}}};n.open("POST",a);n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(e)}};(function(c){if(typeof c.matches!=="function"){c.matches=c.msMatchesSelector||c.mozMatchesSelector||c.webkitMatchesSelector||function b(d){var f=this;var g=(f.document||f.ownerDocument).querySelectorAll(d);var e=0;while(g[e]&&g[e]!==f){++e}return Boolean(g[e])}}if(typeof c.closest!=="function"){c.closest=function a(d){var e=this;while(e&&e.nodeType===1){if(e.matches(d)){return e}e=e.parentNode}return null}}})(window.Element.prototype);document.addEventListener("DOMContentLoaded",function(a){MultiColumnEditor.init()});(function(){if(typeof window.addEvent==="function"){window.addEvent("domready",function(){MultiColumnEditor.initChosen=function(){$$(".multi-column-editor select.tl_chosen").each(function(a){if(typeof a.initialized==="undefined"){a.initialized=$$("#"+a.getAttribute("id")).chosen()}})}})}})();