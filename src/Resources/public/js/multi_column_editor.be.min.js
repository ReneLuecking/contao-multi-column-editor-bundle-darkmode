var MultiColumnEditor={init:function(){this.registerEvents()},registerEvents:function(){utilsBundle.event.addDynamicEventListener("click",".multi-column-editor .add",function(e,t){t.preventDefault(),MultiColumnEditor.triggerAction(e,"addRow")}),utilsBundle.event.addDynamicEventListener("click",".multi-column-editor .delete",function(e,t){t.preventDefault(),MultiColumnEditor.triggerAction(e,"deleteRow")}),new Sortables(".multi-column-editor-wrapper .sortable",{constrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(e){for(var t=[],n=!1,i=e.closest(".rows").querySelectorAll(".mce-row"),a=0;a<i.length;a++)t.push(i[a].dataset.index),i[a].dataset.index!==[].slice.call(i).indexOf(this)+1&&(n=!0);additionalData=[{name:"newIndices",value:t.join(",")}],n&&MultiColumnEditor.triggerAction(e.querySelector(".drag-handle"),"sortRows",additionalData)}})},triggerAction:function(link,action,additionalFormData,callbac){for(var form=link.closest("form"),formData=new FormData,editor=link.closest(".multi-column-editor"),url=link.href,inputs=form.querySelectorAll("input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])"),i=0,len=inputs.length;i<len;i++){var input=inputs[i];if("FORM_SUBMIT"!==input.name)switch(input.type){case"checkbox":case"radio":formData.append(input.name,input.checked?input.value:"");break;default:formData.append(input.name,input.value)}}var row=link.closest(".mce-row");if(formData.set("row",null!=row?row.dataset.index:0),formData.set("field",editor.dataset.field),formData.set("table",editor.dataset.table),formData.set("action",action),void 0!==additionalFormData)for(var i=0,len=additionalFormData.length;i<len;i++){var input=additionalFormData[i];if("FORM_SUBMIT"!==input.name)switch(input.type){case"checkbox":case"radio":formData.append(input.name,input.checked?input.value:"");break;default:formData.append(input.name,input.value)}}var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4===xhr.readyState){var e=document.createEvent("CustomEvent");if(e.initEvent("ajaxSuccess",!0,!0),document.dispatchEvent(e),200===xhr.status){var response=document.createElement("div");response.innerHTML=xhr.responseText;var scriptElems=response.childNodes[0].getElementsByTagName("script");link.closest(".multi-column-editor-wrapper").replaceWith(response.childNodes[0]),MultiColumnEditor.registerEvents(),MultiColumnEditor.initChosen();for(var n=0;n<scriptElems.length;n++)eval(arr[n].innerHTML);"function"==typeof callback&&callback.apply(this,Array.prototype.slice.call(arguments,1));var e=document.createEvent("CustomEvent");e.initEvent("ajaxComplete",!0,!0),document.dispatchEvent(e)}}},xhr.open("POST",url),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.send(formData)}};!function(e){"function"!=typeof e.matches&&(e.matches=e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=this,n=(t.document||t.ownerDocument).querySelectorAll(e),i=0;n[i]&&n[i]!==t;)++i;return Boolean(n[i])}),"function"!=typeof e.closest&&(e.closest=function(e){for(var t=this;t&&1===t.nodeType;){if(t.matches(e))return t;t=t.parentNode}return null})}(window.Element.prototype),document.addEventListener("DOMContentLoaded",function(e){MultiColumnEditor.init()}),"function"==typeof window.addEvent&&window.addEvent("domready",function(){MultiColumnEditor.initChosen=function(){$$(".multi-column-editor select.tl_chosen").each(function(e){void 0===e.initialized&&(e.initialized=$$("#"+e.getAttribute("id")).chosen())})}});