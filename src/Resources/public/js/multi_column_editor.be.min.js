var MultiColumnEditor={init:function(){this.registerEvents()},registerEvents:function(){for(var a=document.querySelectorAll('.multi-column-editor .add'),b=document.querySelectorAll('.multi-column-editor .delete'),c=0;c<a.length;c++)a[c].addEventListener('click',function(a){a.preventDefault(),MultiColumnEditor.triggerAction(this,'addRow')});for(var c=0;c<b.length;c++)b[c].addEventListener('click',function(a){a.preventDefault(),MultiColumnEditor.triggerAction(this,'deleteRow')});(function(a){new Sortables(a,{constrain:!0,opacity:.6,handle:'.drag-handle',onComplete:function(a){for(var b=[],c=!1,d=a.closest('.rows').querySelectorAll('.mce-row'),e=0;e<d.length;e++)b.push(d[e].dataset.index),d[e].dataset.index!==[].slice.call(d).indexOf(this)+1&&(c=!0);additionalData=[{name:'newIndices',value:b.join(',')}],c&&MultiColumnEditor.triggerAction(a.querySelector('.drag-handle'),'sortRows',additionalData)}})})('.multi-column-editor-wrapper .sortable')},triggerAction:function(link,action,additionalFormData,callbac){for(var input,form=link.closest('form'),formData=new FormData,editor=link.closest('.multi-column-editor'),url=link.href,inputs=form.querySelectorAll('input[name]:not([disabled]), textarea[name]:not([disabled]), select[name]:not([disabled]), button[name]:not([disabled])'),i=0,len=inputs.length;i<len;i++)if(input=inputs[i],'FORM_SUBMIT'!==input.name)switch(input.type){case'checkbox':case'radio':formData.append(input.name,input.checked?input.value:'');break;default:formData.append(input.name,input.value);}var row=link.closest('.mce-row');if(formData.set('row','undefined'!=typeof row&&null!==row?row.dataset.index:0),formData.set('field',editor.dataset.field),formData.set('table',editor.dataset.table),formData.set('action',action),'undefined'!=typeof additionalFormData)for(var input,i=0,len=additionalFormData.length;i<len;i++)if(input=additionalFormData[i],'FORM_SUBMIT'!==input.name)switch(input.type){case'checkbox':case'radio':formData.append(input.name,input.checked?input.value:'');break;default:formData.append(input.name,input.value);}var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4===xhr.readyState){var e=document.createEvent('CustomEvent');if(e.initEvent('ajaxSuccess',!0,!0),document.dispatchEvent(e),200===xhr.status){var response=document.createElement('div');response.innerHTML=xhr.responseText;var scriptElems=response.childNodes[0].getElementsByTagName('script');link.closest('.multi-column-editor-wrapper').replaceWith(response.childNodes[0]),MultiColumnEditor.registerEvents(),MultiColumnEditor.initChosen();for(var n=0;n<scriptElems.length;n++)eval(arr[n].innerHTML);'function'==typeof callback&&callback.apply(this,Array.prototype.slice.call(arguments,1));var e=document.createEvent('CustomEvent');e.initEvent('ajaxComplete',!0,!0),document.dispatchEvent(e)}}},xhr.open('POST',url),xhr.setRequestHeader('X-Requested-With','XMLHttpRequest'),xhr.send(formData)}};(function(a){'function'!=typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return!!c[d]}),'function'!=typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})})(window.Element.prototype),document.addEventListener('DOMContentLoaded',function(){MultiColumnEditor.init()}),function(){'function'==typeof window.addEvent&&window.addEvent('domready',function(){MultiColumnEditor.initChosen=function(){$$('.multi-column-editor select.tl_chosen').each(function(a){'undefined'==typeof a.initialized&&(a.initialized=$$('#'+a.getAttribute('id')).chosen())})}})}();